<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Game</title>
<style>
body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;

    background-color: rgb(0, 0, 0); /* 背景图两侧空白可换颜色 */
}

/* 等比例容器，让内容永远跟背景图同一块区域 */
.bg-container {
    aspect-ratio: 9 / 16;   /* 背景图真实比例（非常关键） */
    width: 100%;            /* 自适应大小 */
    max-width: 450px;       /* 最大宽度（电脑不会太大） */

    background: url("sc/backg.png") no-repeat center center;
    background-size: contain;
    background-color: rgba(0, 0, 0, 0);
    position: relative;     /* 允许内部绝对定位 */
}

  .topbar {
    display:flex;
    justify-content:space-between;
    padding:20px;
  }

  .circle {
    width: 60px;
    height: 60px;
    background:white;
    border-radius:50%;
    color:#5a2ca0;
    display:flex;
    justify-content:center;
    align-items:center;
    font-weight:bold;
    font-size:20px;
  }

.btn {
    display: block;      /* 让按钮是块级元素 */
    margin: 40px auto 0 auto; /* 上边距40px，左右自动居中 */
    width: 335px;
    height: 60px;
    background: white;
    color: black;
    font-size: 16px;
    border-radius: 100px;
    border: none;
    cursor: pointer;
    font-family:"Acme", Arial, sans-serif ;
}
  .pic{
  display: block;
  margin: 0 auto;
  }
  .logout {
    color: white;
    text-align:center;
    margin-top:40px;
    opacity:0.8;
    cursor:pointer;
  }
</style>
</head>
<body>
    <div class="bg-container">
  <!-- 顶部栏 -->
  <div class="topbar">
    <img src="sc/Avatar.png"  width="50"  class="circle">
    <div class="circle"> <span id="todayCount">0</span></div>
    <div class="circle"><span id="totalCount">0</span></div>
  </div>

  <!-- 点击按钮，直接用 onclick -->
   <img src="sc/Mask group.png" class="pic" width="40%" style="cursor: pointer;border-radius: 10px;"  onclick="clickButton()">
  <button class="btn" onclick="clickButton()">Tap</button>
  <div class ="logout" onclick="logOut()">Log out</div>
</div>
  <script>
    // 获取登录后的 userid
    const userid = localStorage.getItem("userid");
    if (!userid) {
      alert("请先登录");
      window.location.href = "login.html";
    }

    // 更新计数
    async function updateCounts() {
      try {
        const res = await fetch(`https://backend-production-24ec.up.railway.app/clicks/counts/${userid}`, { method: 'GET' });
        const data = await res.json();
        document.getElementById("todayCount").textContent = data.todayCount;
        document.getElementById("totalCount").textContent = data.totalCount;
      } catch (err) {
        console.error(err);
      }
    }

    // 点击按钮处理函数
    async function clickButton() {
      try {
        const response = await fetch(`https://backend-production-24ec.up.railway.app/clicks/click/${userid}`, { method: 'POST' });
        const result = await response.json();

        if (result.success) {

        } else {
          alert(result.message);
        }
        updateCounts();
      } catch (err) {
        console.error(err);
      }
    }
    async function logOut() {
        try {
        const response = await fetch(`https://backend-production-24ec.up.railway.app/logout`, { method: 'POST'});
        const result = await response.json();

        if (result.success) {
          localStorage.removeItem("userid");
          window.location.href = "login.html";
        } else {
          alert(result.message);
        }
      } catch (err) {
        console.error(err);
      }
    }

    // 页面加载初始化
    updateCounts();
    
  </script>

</body>
</html>
